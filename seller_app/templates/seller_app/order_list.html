<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Order Details</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/datatables.net-bs5@1.11.5/css/dataTables.bootstrap5.min.css" rel="stylesheet">
</head>
<body>

<div class="container my-4">
    <h1 class="text-center">Order Details</h1>
    <a href="{% url 'seller_app:dashboard' %}" class="btn-home">Dashboard</a>

    <!-- Total Orders Table -->
    <h2>Total Orders</h2>
    <table id="totalOrdersTable" class="table table-striped table-bordered" cellspacing="0" width="100%">
        <thead>
            <tr>
                <th>Mobile Number</th>
                <th>Customer</th>
                <th>Product</th>
                <th>Quantity</th>
                <th>Amount (Rs.)</th>
                <th>Status</th>
                <th>Order Date</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for order in orders %}
                <tr>
                    <td>{{ order.mobile_number }}</td>
                    <td>
                        {% if order.customer %}
                            {{ order.customer.name }}
                        {% else %}
                            N/A
                        {% endif %}
                    </td>
                    <td>
                        <img src="{{ order.product.image.url }}" alt="{{ order.product.name }}" width="50" height="50">
                        {{ order.product.name }}
                    </td>
                    <td>{{ order.quantity }}</td>
                    <td>{{ order.total_price }}</td>
                    <td>{{ order.get_status_display }}</td>
                    <td>{{ order.date|date:"d-m-Y" }}</td>
                    <td>
                        <button class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#editOrderModal" 
                                data-order-id="{{ order.id }}" 
                                data-order-quantity="{{ order.quantity }}" 
                                data-order-status="{{ order.status }}">
                            Edit
                        </button>
                        <form method="post" action="{% url 'seller_app:delete_order' order.id %}" style="display:inline;">
                            {% csrf_token %}
                            <button type="submit" class="btn btn-danger btn-sm" onclick="return confirm('Are you sure you want to delete this order?');">
                                Delete
                            </button>
                        </form>
                    </td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- Edit Order Modal -->
<div class="modal fade" id="editOrderModal" tabindex="-1" aria-labelledby="editOrderModalLabel" aria-hidden="true">
    <div class="modal-dialog">
		
				
        <div class="modal-content">
            <form method="post" action="{% url 'seller_app:edit_order' %}">
                {% csrf_token %}
				
				{% if messages %}
				<div id="message-container">
					<ul class="messages">
						{% for message in messages %}
							<li class="{{ message.tags }}">{{ message }}</li>
						{% endfor %}
					</ul>
				</div>
				<script>
					// Hide messages after a short delay
					setTimeout(function() {
						const messageContainer = document.getElementById('message-container');
						if (messageContainer) {
							messageContainer.style.display = 'none';
						}
					}, 3000); // 3000ms = 3 seconds
				</script>
				{% endif %}
				
                <div class="modal-header">
                    <h5 class="modal-title" id="editOrderModalLabel">Edit Order</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <input type="hidden" id="orderId" name="order_id">
                    <div class="mb-3">
                        <label for="quantity" class="form-label">Quantity</label>
                        <input type="number" id="quantity" name="quantity" class="form-control" required>
                    </div>
                    <div class="mb-3">
                        <label for="status" class="form-label">Status</label>
                        <select id="status" name="status" class="form-select">
							<option value="">Select</option>
							<option value="Pending">Pending</option>
							<option value="Delivered">Delivered</option>
							<option value="Cancelled">Cancelled</option>
							<option value="No Stock">No Stock</option>
						</select>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-success">Save Changes</button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Bootstrap JS and DataTables JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/datatables.net@1.11.5/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/datatables.net-bs5@1.11.5/js/dataTables.bootstrap5.min.js"></script>

<script>
    $(document).ready(function() {
        $('#totalOrdersTable').DataTable();

        // Populate Edit Modal with order data
        $('#editOrderModal').on('show.bs.modal', function (event) {
            var button = $(event.relatedTarget); // Button that triggered the modal
            var orderId = button.data('order-id');
            var quantity = button.data('order-quantity');
            var status = button.data('order-status');

            var modal = $(this);
            modal.find('#orderId').val(orderId);
            modal.find('#quantity').val(quantity);
            modal.find('#status').val(status);
			
			 // Ensure the modal is fully visible before setting focus
            setTimeout(function() {
                modal.find('#quantity').focus();
            }, 500); // Delay to allow the modal to fully open
        });
    });
</script>

</body>
</html>
